<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>{{ title }}</title>
  <style>
    /* 防止渲染前闪烁 */
    .mermaid {
      visibility: hidden;
    }
  </style>
</head>
<body>
  <div id="content" class="markdown-body" style="padding:8px"></div>

  <!-- Mermaid 容器 -->
  <div id="mermaid-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script>
    // 初始化 Mermaid
    mermaid.initialize({ startOnLoad: false });

    document.addEventListener("DOMContentLoaded", () => {
      const raw = `{{ data|escape }}`; // 原始 mermaid 文本
      
      // 动态创建节点
      const el = document.createElement("div");
      el.className = "mermaid";
      el.textContent = raw;

      document.getElementById("mermaid-container").appendChild(el);

      // 渲染
      mermaid.run({
        nodes: [el]
      });

      // 渲染完成后显示
      el.style.visibility = "visible";
    });
  </script>
</body>
</html>
